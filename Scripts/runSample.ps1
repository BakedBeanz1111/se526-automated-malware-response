# Written by Amad Ali(AmadAli23@gmail.com)
# Environment: Powershell
# Run As Admin
# Usage: runSample.ps1 Foo.bar

# To Do List:
# Step 1) Start ProcExp.exe
# Step 2) Start Procmon.exe
# Step 3) Start Fakenet
# Step 4) Run Sample
# Step 5) Save ProcEXP data
# Step 6) Save Procmon data
# Step 7) Save fakenet data
# Step 8) Refresh Environment

$Filename = $args[0]	#$Filename from the example would be "Foo.bar"

echo "Starting Process Explorer"
Start-Process -FilePath "C:\Tools\Sys Internals Suite\procexp64.exe"

echo "Starting Process Monitor"
Start-Process -FilePath "C:\Tools\Sys Internals Suite\procmon64.exe"

echo "Starting Fakenet"
Start-Process -FilePath "C:\Tools\Fakenet\faknet.exe"

echo "Running sample"
Start-Process -FilePath $Filename

echo "Sample is running, waiting for a minute to let sample run"
Start-Sleep -s  60

echo "Saving logged data"
# Write an automation script to save ProcEXP/ProcMon data
# Grab Fakenet logs
# Create Log dump of all information

echo "Refreshing Environment"
# Write an automation script to load a fresh environment of VM